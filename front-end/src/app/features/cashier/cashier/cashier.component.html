<div class="cashier-container">
  <div class="products-section">
    <!-- Search Bar -->
    <mat-form-field class="search-field" appearance="outline">
      <mat-label>Search Products</mat-label>
      <input matInput
             [(ngModel)]="searchTerm"
             (ngModelChange)="onSearch($event)"
             placeholder="Search by name or barcode">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <!-- Error Message -->
    <mat-error *ngIf="error" class="error-message">
      {{error}}
    </mat-error>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-spinner">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- Products Accordion -->
    <mat-accordion class="products-accordion" *ngIf="!loading && !error">
      <mat-expansion-panel [expanded]="searchTerm && filteredProductCategories.size > 0">
        <mat-expansion-panel-header>
          <mat-panel-title>Products</mat-panel-title>
        </mat-expansion-panel-header>

        <!-- Sub-categories -->
        <mat-accordion multi="true">
          <mat-expansion-panel *ngFor="let category of filteredProductCategories.keys()" [expanded]="!!searchTerm">
            <mat-expansion-panel-header>
              <mat-panel-title>{{category}}</mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Products List -->
            <div class="products-grid">
              <mat-card *ngFor="let product of filteredProductCategories.get(category)?.values()" class="product-card">
                <mat-card-header>
                  <mat-card-title>{{product.name}}</mat-card-title>
                  <mat-card-subtitle>{{product.price | currency}}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-actions>
                  <button mat-button color="primary" (click)="addToBasket(product)">
                    <mat-icon>add_shopping_cart</mat-icon> Add
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-expansion-panel>
    </mat-accordion>

    <!-- Entry Products Accordion -->
    <mat-accordion class="entry-products-accordion" *ngIf="!loading && !error">
      <mat-expansion-panel [expanded]="searchTerm && filteredEntryProductCategories.size > 0">
        <mat-expansion-panel-header>
          <mat-panel-title>Entry Products</mat-panel-title>
        </mat-expansion-panel-header>

        <!-- Sub-categories -->
        <mat-accordion multi="true">
          <mat-expansion-panel *ngFor="let category of filteredEntryProductCategories.keys()" [expanded]="!!searchTerm">
            <mat-expansion-panel-header>
              <mat-panel-title>{{category}}</mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Entry Products List -->
            <div class="products-grid">
              <mat-card *ngFor="let product of filteredEntryProductCategories.get(category)" class="product-card">
                <mat-card-header>
                  <mat-card-title>{{product.name}}</mat-card-title>
                  <mat-card-subtitle>{{product.price | currency}}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-actions>
                  <button mat-button color="primary" (click)="addToBasket(product, true)">
                    <mat-icon>add_shopping_cart</mat-icon> Add
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <!-- Basket Section -->
  <div class="basket-section">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Shopping Basket</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="basket.length === 0" class="empty-basket">
          <mat-icon>shopping_basket</mat-icon>
          <p>Your basket is empty</p>
        </div>
        <mat-list *ngIf="basket.length > 0">
          <mat-list-item *ngFor="let item of basket" class="basket-item">
            <div class="basket-item-content">
              <span class="item-name">{{item.name}}</span>
              <div class="quantity-controls">
                <button mat-icon-button (click)="updateQuantity(item.id, false)">
                  <mat-icon>remove</mat-icon>
                </button>
                <span class="quantity">{{item.quantity}}</span>
                <button mat-icon-button (click)="updateQuantity(item.id, true)">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <span class="item-price">{{item.total | currency}}</span>
              <button mat-icon-button color="warn" (click)="removeFromBasket(item.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
      <mat-card-footer class="basket-footer" *ngIf="basket.length > 0">
        <div class="total-sum">
          <strong>Total:</strong> {{totalSum | currency}}
        </div>
      </mat-card-footer>
    </mat-card>
  </div>
</div>
